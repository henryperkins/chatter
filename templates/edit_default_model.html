{% extends "base.html" %}

{% block title %}Edit Default Model Configuration{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-4">Edit Default Model Configuration</h1>

    {% if model_error %}
    <div class="bg-red-100 dark:bg-red-900/50 border border-red-400 dark:border-red-800 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg relative mb-6" role="alert">
        <strong class="font-bold">Error:</strong>
        <span class="block sm:inline">{{ model_error }}</span>
    </div>
    {% endif %}

    <form method="POST" action="{{ url_for('auth.edit_default_model') }}" class="space-y-6">
        {{ form.hidden_tag() }}
        {{ form.model_type() }}

        <!-- Model Name -->
        <div class="space-y-1">
            {{ form.name.label(class="block font-medium text-gray-700 dark:text-gray-300") }}
            {{ form.name(class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200") }}
            {% if form.name.errors %}
            <p class="text-red-600 dark:text-red-400 text-sm">{{ form.name.errors[0] }}</p>
            {% endif %}
        </div>

        <!-- Deployment Name -->
        <div class="space-y-1">
            {{ form.deployment_name.label(class="block font-medium text-gray-700 dark:text-gray-300") }}
            {{ form.deployment_name(class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200") }}
            {% if form.deployment_name.errors %}
            <p class="text-red-600 dark:text-red-400 text-sm">{{ form.deployment_name.errors[0] }}</p>
            {% endif %}
        </div>

        <!-- Description -->
        <div class="space-y-1">
            {{ form.description.label(class="block font-medium text-gray-700 dark:text-gray-300") }}
            {{ form.description(class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200") }}
            {% if form.description.errors %}
            <p class="text-red-600 dark:text-red-400 text-sm">{{ form.description.errors[0] }}</p>
            {% endif %}
        </div>

        <!-- API Endpoint -->
        <div class="space-y-1">
            {{ form.api_endpoint.label(class="block font-medium text-gray-700 dark:text-gray-300") }}
            {{ form.api_endpoint(class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200") }}
            {% if form.api_endpoint.errors %}
            <p class="text-red-600 dark:text-red-400 text-sm">{{ form.api_endpoint.errors[0] }}</p>
            {% endif %}
        </div>

        <!-- API Key -->
        <div class="space-y-1">
            {{ form.api_key.label(class="block font-medium text-gray-700 dark:text-gray-300") }}
            {{ form.api_key(class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200") }}
            {% if form.api_key.errors %}
            <p class="text-red-600 dark:text-red-400 text-sm">{{ form.api_key.errors[0] }}</p>
            {% endif %}
        </div>

        <!-- Temperature -->
        <div class="space-y-1">
            {{ form.temperature.label(class="block font-medium text-gray-700 dark:text-gray-300") }}
            {{ form.temperature(class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200") }}
            {% if form.temperature.errors %}
            <p class="text-red-600 dark:text-red-400 text-sm">{{ form.temperature.errors[0] }}</p>
            {% endif %}
        </div>

        <!-- Max Tokens -->
        <div class="space-y-1">
            {{ form.max_tokens.label(class="block font-medium text-gray-700 dark:text-gray-300") }}
            {{ form.max_tokens(class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200") }}
            {% if form.max_tokens.errors %}
            <p class="text-red-600 dark:text-red-400 text-sm">{{ form.max_tokens.errors[0] }}</p>
            {% endif %}
        </div>

        <!-- Max Completion Tokens -->
        <div class="space-y-1">
            {{ form.max_completion_tokens.label(class="block font-medium text-gray-700 dark:text-gray-300") }}
            {{ form.max_completion_tokens(class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200") }}
            {% if form.max_completion_tokens.errors %}
            <p class="text-red-600 dark:text-red-400 text-sm">{{ form.max_completion_tokens.errors[0] }}</p>
            {% endif %}
        </div>

        <!-- API Version -->
        <div class="space-y-1">
            {{ form.api_version.label(class="block font-medium text-gray-700 dark:text-gray-300") }}
            {{ form.api_version(class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-200") }}
            {% if form.api_version.errors %}
            <p class="text-red-600 dark:text-red-400 text-sm">{{ form.api_version.errors[0] }}</p>
            {% endif %}
        </div>

        <!-- Requires o1 Handling -->
        <div class="space-y-1">
            {{ form.requires_o1_handling.label(class="block font-medium text-gray-700 dark:text-gray-300") }}
            {{ form.requires_o1_handling(class="ml-2") }}
            {% if form.requires_o1_handling.errors %}
            <p class="text-red-600 dark:text-red-400 text-sm">{{ form.requires_o1_handling.errors[0] }}</p>
            {% endif %}
        </div>

        <!-- Supports Streaming -->
        <div class="space-y-1">
            {{ form.supports_streaming.label(class="block font-medium text-gray-700 dark:text-gray-300") }}
            {{ form.supports_streaming(class="ml-2") }}
            {% if form.supports_streaming.errors %}
            <p class="text-red-600 dark:text-red-400 text-sm">{{ form.supports_streaming.errors[0] }}</p>
            {% endif %}
        </div>

        <!-- Submit Button -->
        <button type="submit"
                class="w-full px-6 py-3 text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transform hover:scale-[1.02] transition-all duration-200">
            Save Configuration
        </button>
    </form>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const requiresO1HandlingCheckbox = document.getElementById('requires_o1_handling');
        const temperatureField = document.getElementById('temperature');
        const streamingCheckbox = document.getElementById('supports_streaming');

        function toggleTemperatureField() {
            if (requiresO1HandlingCheckbox.checked) {
                temperatureField.value = '1.0';
                temperatureField.disabled = true;
                streamingCheckbox.checked = false;
                streamingCheckbox.disabled = true;
            } else {
                temperatureField.disabled = false;
                streamingCheckbox.disabled = false;
            }
        }

        requiresO1HandlingCheckbox.addEventListener('change', toggleTemperatureField);
        toggleTemperatureField();  // Initialize on page load
    });
</script>
{% endblock %}
